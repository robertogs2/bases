Preparando máquinas ************************************ 
	-Instalar Windows Server 2016 en las 3 máquinas virtuales de VMWare, seleccionar instalar OS luego, y darle settings > iniciar desde CD/DVD y seleccionar ISO (VM)
	-Ponerles de nombre clusterdc, node1, node2 (VM)
		-AL instalar el clusterdc ponerle Bridged connection
		-Al instalar los nodos 1 y 2, escoger en network-adapter Bridge y agregar otro nuevo con host-only (sino cambiar luego a pata) (VM)
	-Poner passwords para los usuarios (pref 2486abc!)(OS) //A
	-Quitar el Firewall en las tres máquinas (OS)
	-Quitar UAC (User Account Control Settings) hasta el nivel más bajo
	-Cambiar el nombre para cada una de las 3 máquinas en el OS (OS)
		-Click derecho This PC > Propiedades
		-Click en cambiar configuración > Cambiar...
		-Colocar nombre y reiniciar

Crear el dominio ************************************ (clusterdc)
	-Poner el ip estático a clusterdc
		-Entrar a Panel de Control > Network and Sharing Center > Manage networks
		-Click derecho sobre Local Area Connection, Properties
		-Escoger IPv4 > Properties
		-Escribir el ip para clusterdc(pref 192.168.1.110)//ipclusterdc
		-Escribir submask como (255.255.255.0)
		-Escribir el default gateway como el router address (192.168.1.1)
		-Escribir en DNS (127.0.0.1), dejar alternate en blanco
		-Ok
	//Esta parte hay que cambiarla, windows server 2016 ya lo tiene menos feo, basicamente es darle a start al servidor instalar active directory y darle next next next hasta new forest
	-Correr en execute(Windows + R) >dcpromo
		-Next > Next > Create a new domain in a new forest > Next 
		-Ponerle un nombre al dominio (pref metamanager.local) > Next
		-Seleccionar el forest functional level (pref 2016) > Next
		-Seleccionar DNS server > Next > yes > Next
		-Poner una contraseña (pref 2486abc!) > Next //B
		-Finish > Restart

Create the Zone ************************************ (clusterdc)
	-Abrir DNS Manager desde Tools
	-Abrir CLUSTERDC > RC Reverse Lookup Zones > New Zone > Next
	-Escoger Primary Zone > Next
	-Escoger To all domain services in this domain > Next
	-Escoger Ipv4 > Next
	-Poner en Network ID: 192.168.1. (dejar libre el último) > Next
	-Allow only secure... (default) > Next > Finish

	-Host para node1
		-Abrir CLUSTERDC > Forward Lookup Zones
		-RC (pref metamanager.local) > New Host (A or AAAA)...
		-Name (node1) y IP address del nodo 1 (pref 192.168.1.111) //ipnodo1
		-Seleccionar Create associated pointer (PTR) record > Add Host > Done
	-Host para node2
		-Abrir CLUSTERDC > Forward Lookup Zones
		-RC (pref metamanager.local) > New Host (A or AAAA)...
		-Name (node2) y IP address del nodo 1 (pref 192.168.1.112) //ipnodo2
		-Seleccionar Create associated pointer (PTR) record > Add Host > Done}

	-Ver en metamanager.local si se agregaron, al igual que en Reverse Lookup Zones > 1.168.192.in...

Crear cluster admin ********************************** (clusterdc)
	-Abrir Active Directory Users and Computers
	-Abrir metamanager.local
	-RC Users > New > User
	-Ponerle nombre (pref cluadm) e igual en User logon name (pref cluadm) > Next
	-Poner contraseña (pref 2486abc!) //B
	-Seleccionar solamente password never expires > Next > Finish

	-(pref metamanager.local) > Users > RC (pref cluadm) > Add to group
	-Locations > (pref metamanager.local) > OK
	-Domain Admins > Check Names > Ok > Ok

Agregar los nodos al dominio ************************* (node1 y node2)

	-RC This PC > Change Settings > Change
	-Seleccionar domain y poner el domain (pref metamanager.local)
	-Poner usuario y contraseña (pref cluadm, pref 2486abc!) > Ok

	//Se produce error

	-Poner el ip publico estático a node1
		-Entrar a Panel de Control > Network and Sharing Center > Change Adapter Settings
		-RC sobre Local Area Connection(el primero), Properties
		-Escoger IPv4 > Properties
		-Escribir el ip para node1(pref 192.168.1.111)//ipnode1
		-Escribir submask como (255.255.255.0)
		-Escribir el default gateway como el router address (192.168.1.1)
		-Escribir en DNS el ip del clusterdc(192.168.1.110), dejar alternate en blanco
		-Ok

	-Poner el ip publico estático a node2
		-Entrar a Panel de Control > Network and Sharing Center > Manage networks
		-RC sobre Local Area Connection(el primero), Properties
		-Escoger IPv4 > Properties
		-Escribir el ip para node2(pref 192.168.1.112)//ipnode2
		-Escribir submask como (255.255.255.0)
		-Escribir el default gateway como el router address (192.168.1.1)
		-Escribir en DNS el ip del clusterdc(192.168.1.110), dejar alternate en blanco
		-Ok

	-Poner el ip privado estático a node2
		-Entrar a Panel de Control > Network and Sharing Center > Manage networks
		-RC sobre Local Area Connection(el segundo), Properties
		-Escoger IPv4 > Properties
		-Escribir el ip para node2(pref 192.168.2.12)//ipnode2 private
		-Escribir submask como (255.255.255.0)
		-Ok

	//Hacer lo mismo con el node1 ip: (pref 192.186.2.11)

Probar las conexiones****************************** (clusterdc, node1, node2)

	//En todos correr
	-Correr en cmd
	-ping node1ip (pref 192.168.1.111)
	-ping node2ip (pref 192.168.1.112)
	-ping clusterdc (pref 192.168.1.110)




Agregar servidores a Server Manager...

Instalar features ***************************************** (node1 y node2) {
	-Server Manager > Manage > Add Roles and Features > Next
	-Role-bases or feature based... > Next
	-Seleccionar el servidor (clusterdc) > instalar .NET Framework 3.5, 4.5, Failover Clustering Multipath > Next
	-(Necesita seleccionar disco de .NET svx ) > Instalar


Crear storage virtual**************************************(clusterdc)
	-File and Storage Services > iSCSI > Add Roles and Features Wizard
	-Click en el servidor > Next > Next > Install 
	-Esperar a que termine la instalación > Close
	-Agregar el virtual disk
		-En iSCSI darle refresh > start the New iSCSI Virtual Disk Wizard
		-Seleccionar el location del volumen correspondiente con el servidor > Next
		-Ponerle nombre (pref VD01 {virtual disk 01}) > Next
		-Ponerle un tamaño(pref 10GB) y dynamically expanding > Next
		-New iSCSI Target > Next
		-Ponerle nombre al target (pref VD01-Target)
		-Seleccionar servidores que acceden al disk
			-Add...
			-Click en browse para agregar ambos nodos
			-Advanced > Find Now
			-Seleccionar node1 > OK > OK > OK
			-Seleccionar node2 > OK > OK > OK
		-Darle Next
		-Dejar en blanco (Si no se requiere autenticación) > Next > Create
	-Agregar otro disco llamada VD02 con los pasos anteriores //Va a haber que agregar otros 2, 1 mas grande que los otros 3 
	-Verificar que Virtual Disk Status y Target Status estén en Not Connected

Iniciar/Descubrir iSCSI Targets Disks y conectar en nodos *********(node1 y node2)
	-Abrir disk management para observar que no hay disk1 y disk2
	-Server Manager > Dashboard > Tools > iSCSI Initiator > Yes
	-Poner en target el ip publico de (pref clusterdc) osea (192.168.1.110) > quick connect
	-Conectar a ambos discos seleccionando y dando  connect > Done
	-Volume and Devices > AutoConfigure
	-Hacerlo para ambos nodos

	-Abrir disk management en node1
	-RC en disk1 y disk2 > online
	-RC initialize ambos (MBR) > Ok //los 4

	-RC disk1 > New simple volume > Next
	-Assign the following drive letter: Q > Next
	-NTFS, Default, Quick Format, Volumne label (pref Quorum-Disk) > Next > Finish
	-RC disk2 > New simple volumne > Next
	-Drive letter D > Next
	-Volume label (SQL-Disk) > Next > Finish//ponerle data
	//ponerle msdtc y logs a los otros

	-En node2
		-disk management y online ambos discos
		-cambiar letras a Q y D

Crear el cluster******************************(node1 y clusterdc)
	-Ver LAN y Heartbeat ips
	-En node1
		-Server Manager > Dashboard > Tools > Failover Cluster Manager
		-Click en validate Configuration > Next
		-Agregar ambos nodos
			-Browse > Advanced > Find Now
			-Seleccionar Nodo > Ok
		-Next > Seleccionar lo que quiera (pref todo) > Next > Next
		-View report
		-Check create cluster with validated nodes > Next
		-Poner Cluster Name (pref WIN-SQL-CLUSTER)
		-Poner el ip del cluster(pref 192.168.1.113) > Next
		-Add all eligible storage to the cluster > Next
		-Finish

		-Chequear todo en Failover Cluster Manager
		->Nombre del cluster > Storage > Disks
		-Cambiar nombre de disco (Quorum-Disk) y (SQL-Disk) //ponerle data al de sql y cambiarle de nombre tambien a los otros dos por msdtc y logs
		-Networks cambiar de nombre Cluster Only por Heartbeat y Cluster and Client por LAN (Allow clients debe estar chequeado)

	-En clusterdc
		-Server Manager > Dashboard > Tools > Active Directory Users and Computers
		-(Domain metamanager.local) > (INDIA ?????? = Computers) > Servers, aqui deben mostrarse los nodos y el cluster con descipcion

		-En networks deben mostarse ips privados por separado a los publicos
		-En Storage, cada disco debe tener la letra asignada como se requiere, sino:
			-RC Cluster > More options > Configure Cluster Quorum Settings > Next > Node and Disk Majority > Next
			-Escoger el disco Q > Next > Next > Finish

		-Puntero del DNS para (WIN-SQL-CLUSTER):
			-Server Manager > Dashboard > Tools > DNS
			-Forward Lookup Zones > (Domain metamanager.local) > RC (pref WIN-SQL-CLUSTER) > Properties
			-Check en update associated pointer PTR
			-Refresh reverse lookup zones
		-Probar mandando ping a todo mundo 

	-Se puede cambiar el disco por un file shared[part6B minute 6 - 8], y para acceder a otra maquina en el dominio se pone en exe: \\clusterdc\c$Windows

Instalar SQL Server en el cluster *******************(node1) {tener cuidado porque hay que instalar el chorro de services, aunque no se recomienda hacerlo ya}
	-En node1, meter la llave con SQL Server y extraer los archivos
	-Montar la imagen de SQL Server / Meter el ejecutable

	-Crear application server en ambos nodes
		-Server Manager > Add roles and features > Next > Application server > Ok > Next > Check incoming and outgoing > Next
		-Install > Close

	-Agregar MSDTC service
		-Server Manager > Failover clustering manager
		-(pref WIN-SQL-CLUSTER) > RC Services and Applications > Configure Service > Next
		-Seleccionar DTC (Distributed Transaction Coordinator) > Next
		-Poner nombre (pref WIN-SQL-CLUSTERDtc) y en el ip poner (pref 192.168.1.114) > Next
		-Escoger el disco dedicado a MSDTC (pref msdtc-disk) > Next > Next > Finish


	-Correr setup de SQL Server
	-Installation > New SQL Server failover cluster installation
	-Si todo pasa > Ok > Evaluation > Accept Terms > Next
	-Esperar a ver si tira warnins (talvez importan) > Next > SQL Server Feature Installation > Next
	-Seleccionar Features, Database Engine Services y Management Tools (with complete) > Next
	-Si pasa > Next
	-Ponerle un nombre (pref DEVSQLCLU) y Default instance > Next > Next
	-Tira warnings de windows failover clustering > Next
	-Se muestran los discos, escoger (pref logs-disk y data-disk) > Next
	-Poner el ipv4 (pref 192.168.1.115) y marcar la casilla (desmcarcar dhcp), en subnet mask (255.255.255.0)> Next
	-User sid > Next > 
	-Use the same account for all SQL Server services
	-Poner cuenta y contraseña > Next > Windows Authetication Mode, Add Current User
	-Verificar que todo se vaya a hacer en (data-disk) drive desde data directories> Next
	-Next chequear SQL Server Replication> Install > Next > Close

	-Verificar en los roles de Server Manager > Dashboard > Tools > Failover Cluster Management
	-RC (SQL Server) > Refresh
	-RC (SQL Server) > Properties
	-A la derecha Show Dependency Report


	-Entrar a Failover Cluster Management > Click sobre Services and Applications > RC SQL Server 
	-Seleccionar ambos nodos del cluster y cambiar prioridad a alto //Esto no lo hizo el indio 2

	-Abrir Microsoft SQL Server Manager Studio
	-Poner el nombre del servidor y conectarse
	-Probar hacer ping a el sql-cluster (devsqlclu)

Instalar SQL Server en otro nodo ******************************* (node2 y node1)
	-Ejecutar el instalador > Installation
	-Add node to a SQL failover cluster
	-Specify a free edition: Enterprise > Next > Accept terms > Next
	-Install
	-Escoger instancia de SQL Server (solo hay una) > Next
	-Poner passwords en agent, y databse engine> Next > Next > Next y esperar que agregue el nodo

	-Abrir Failover Cluster Management en node1 > refresh SQL Server > RC SQL Server > Properties > Advanced Policies para ver ambos nodos
	//Puede que haya que poner node1 como owner de SQL y node2 como owner de dtc

	//Aun en node1
	-Abrir SSMS
	-Connectar al servidor
	-Darle New Query y correr select SERVERPROPERTY ('computernamephysicalnetbios')
	-Failover Cluster Management > RC SQL Server (MSSQLSERVER) > Move to node2 > Ok > Esperar a que refresque (spamear refresh)
	-Ejecutar query de nuevo para ver como cambia a node2
	-En fcm > Storage deben de estar los discos de SQL Server corriendo sobre node2, igual que winclusterdtc
	//Asi se hace failover manualmente, click derecho mover al otro nodo...

Hacer los nodos active-active ******************************(node1 y node2)


	-En node2 abrir SQL Server Configuration Manager > SQL Server Services
	-Ver que todos los servicios esten corriendo

	-En node1 hacer lo mismo y ver que estan caidos
	-Hacer failover de node2 a node1 el SQL Server y ver como ahora si corren